<!DOCTYPE html>
<html lang="en">
    <head>
        <title>sign up</title>
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
    <body>
        <div class="success" style="background-color: green; color: white; text-align: center;">
            <p id="successMessage" ></p>
        </div>
        <div class="failed" style="background-color: red; color: white; text-align: center;">
            <p id="failedMessage" ></p>
        </div>

        <div class="signup-container">
            <div class="header-group">
                <h3>Register New User</h3>
            </div>
            
            <form title="Register" onsubmit="check_form(this); return false;" method="post">

                <div class="form-group">
                <label for="username">Username </label>
                    <input type="text" id="username" name="username" required>
                </div>
           
                <div class="form-group">
                <label for="password">Password </label>
                    <input type="password" id="password" name="password" required>
                </div>
              
                <div class="form-group"> 
                <label for="rePassword">Retype Password </label>
                    <input type ="password" id="rePassword" name="rePassword" required>
                </div>

                <div class="form-group">
                    <p id="message" style="color: red;"></p>
                </div>

                <div class="button-group">
                <button type="submit" name="submit" style=" background-color: rgb(173 210 231)" >SUBMIT</button>
                <button type="reset" name="cancel" style="background-color: rgb(243, 168, 168);">CANCEL</button>
                </div>
            </form>
        </div>
        <script>
            function check_form(form) {
                
                var password = document.getElementById("password").value;
                var retype =  document.getElementById("rePassword").value;
                console.log("password:"+password);
                var message = document.getElementById("message");


                if (form !== undefined && password == retype) {
                    // Validation succeeded, submit the form
                    message.innerHTML = "";
                    registerUser();
                } else {
                    event.preventDefault();
                    message.innerHTML = "Passwords do not match!"
                }

                
            }

            function registerUser() {
                console.log("Inside register user");
                const  username = document.getElementById('username').value;
                const  password = document.getElementById('password').value;
                var smessage = document.getElementById("successMessage");
                

                var fmessage = document.getElementById("failedMessage");
              
                
                fetch("http://127.0.0.1:5000/user",{
                    method: 'POST',
                    headers: { 'Content-Type':'application/json'},
                    body: JSON.stringify({username, password})
                }).then(response =>{

                    if (response.status == 200) {
                        fmessage.innerHTML = "";
                        smessage.innerHTML = 'User registered successfully.';
                    }
                    else if (response.status == 401) {
                        smessage.innerHTML = "";
                        fmessage.innerHTML = 'User already exist.';
                    } else {
                        smessage.innerHTML = "";
                        fmessage.innerHTML = 'Registration failed.';
                    }                 
                
                }).catch(error =>{
                    console.error("Registration error:",error);
                });
                
            }
            



            
        </script>
    </body>
</html>