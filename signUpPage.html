<!DOCTYPE html>
<html lang="en">
    <head>
        <title>sign up</title>
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
    <body>
        <div class="signup-container">
            <div class="header-group">
                <h3>Register New User</h3>
            </div>
            
            <form title="Register"  onsubmit="return validateForm(event)">

                <div class="form-group">
                <span><label for="username">Username </label>
                    <input type="text" id="username" name="username" required></span>
                </div>
           
                <div class="form-group">
                <label for="password">Password </label>
                    <input type="password" id="password" name="password" required>
                </div>
              
                <div class="form-group"> 
                <label for="rePassword">Retype Password </label>
                    <input type ="password" id="rePassword" name="rePassword" required>
                </div>

                <div class="form-group">
                    <p id="message" style="color: red;"></p>
                </div>

                <div class="button-group">
                <button type="submit" name="submit" style=" background-color: rgb(173 210 231)">SUBMIT</button>
                <button type="reset" name="cancel" style="background-color: rgb(243, 168, 168);">CANCEL</button>
                </div>
            </form>
        </div>
        <script>
            function validateForm(event) {
                
                var password = document.getElementById("password").value;
                var retype =  document.getElementById("rePassword").value;
                console.log("password:"+password);
                var message = document.getElementById("message");

                if(password !== retype){
                    event.preventDefault();
                    message.innerHTML = "Passwords do not match!"
                }else{
                    message.innerHTML = "";
                    registerUser();
                }
            }

            function registerUser() {
                
                const  username = document.getElementById('username').value;
                const  password = document.getElementById('password').value;
                
                fetch("http://127.0.0.1:5000/user",{
                    method: 'POST',
                    headers: { 'Content-Type':'application/json'},
                    body: JSON.stringify({username, password})
                }).then(response =>{

                    alert(response.status);
                    if (response.status == 200) {
                        alert('User registered successfully.');
                    }
                    else if (response.status == 401) {
                        alert('Username is already exist.');
                    } else {
                        alert('Registration failed.');
                    }                 
                
                }).catch(error =>{
                    console.error("Registration error:",error);
                });


                /*
                fetch("http://127.0.0.1:5000/register",{
                    method: 'POST',
                    headers: { 'Content-Type':'application/json'},
                    body: JSON.stringify({username, password})
                }).then(response =>{
                    alert("hello world");
                    console.log(response);
                    // if (response.status == 200) {
                    //     window.alert('User registered successfully.');
                    //     console.log('User registered successfully.');
                    // }else if(response.status === 400){
                    //     window.alert('Username is already exist.');
                    //     console.log('Username is already exist.');
                    // }else {
                    //     window.alert('Registration failed.');
                    //     console.log('Registration failed.');
                    // }
                }).catch(error =>{
                    console.error("Registration error:",error);
                });*/

            }
            



            
        </script>
    </body>
</html>